---
import { getCollection } from 'astro:content';
import WaveDivider from '@/components/WaveDivider.astro';
import SectionHeader from '@/components/ui/SectionHeader.astro';

type Props = {
  id?: string;
  heading?: string;
  description?: string;
  showWave?: boolean;
};

const {
  id = 'faq',
  heading = 'FAQ',
  description = 'Quick answers to common questions.',
  showWave = true,
} = Astro.props;

const faqs = await getCollection('faqs');
const items = faqs.map((f) => f.data);
---

<section id={id} class="section section-creative scroll-mt-20 pb-0">
  <div class="container-page relative">
    <SectionHeader eyebrow="FAQ" heading={heading} description={description} />

    <div aria-hidden="true" class="pointer-events-none absolute inset-x-0 -top-10 -z-10">
      <div class="mx-auto h-64 w-[min(70rem,94vw)] rounded-full bg-brand-400/10 blur-3xl"></div>
    </div>

    <div class="mt-8 grid gap-3" data-faq>
      {
        items.map((it) => (
          <details class="glass-panel group overflow-hidden" data-faq-item>
            <summary class="text-strong flex w-full cursor-pointer list-none items-center justify-between gap-4 px-6 py-5 text-left text-sm font-semibold focus-visible:outline-none">
              <span>{it.question}</span>
              <span
                class="grid h-8 w-8 place-items-center rounded-full border border-brand-200/50 bg-white/60 text-base leading-none text-brand-700 shadow-sm backdrop-blur-sm dark:border-white/10 dark:bg-slate-900/40 dark:text-brand-300"
                aria-hidden="true"
                data-faq-icon
              >
                +
              </span>
            </summary>
            <div class="px-6 pb-6 text-sm leading-relaxed text-muted">
              <p>{it.answer}</p>
            </div>
          </details>
        ))
      }
    </div>
  </div>

  {
    showWave ? (
      <div class="relative -mb-px mt-12">
        <WaveDivider tone="surface-muted" class="absolute bottom-0 left-0 right-0" />
      </div>
    ) : null
  }

  <script>
    (() => {
      const root = document.querySelector('[data-faq]');
      if (!root) return;

      const items = Array.from(root.querySelectorAll<HTMLDetailsElement>('[data-faq-item]'));

      const syncIcon = (el: HTMLDetailsElement) => {
        const icon = el.querySelector<HTMLElement>('[data-faq-icon]');
        if (!icon) return;
        icon.textContent = el.open ? 'â€“' : '+';
      };

      items.forEach((el) => {
        syncIcon(el);
        el.addEventListener('toggle', () => {
          // Keep it "dropdown" style: only one open at a time.
          if (el.open) items.forEach((other) => other !== el && (other.open = false));
          items.forEach(syncIcon);
        });
      });
    })();
  </script>
</section>

<style>
  /* Remove the default disclosure triangle marker for a cleaner dropdown look. */
  summary::-webkit-details-marker {
    display: none;
  }
</style>
