---
import { siteConfig } from '@/data/siteConfig';
import WaveDivider from '@/components/WaveDivider.astro';
import SectionHeader from '@/components/ui/SectionHeader.astro';

type Props = {
  id?: string;
  heading?: string;
  description?: string;
  showWave?: boolean;
};

const {
  id = 'faq',
  heading = 'FAQ',
  description = 'Quick answers to common questions.',
  showWave = true,
} = Astro.props;

const items = siteConfig.faqs;
---

<section id={id} class="section section-creative scroll-mt-20 pb-0">
  <div class="container-page relative">
    <SectionHeader eyebrow="FAQ" heading={heading} description={description} />

    <div aria-hidden="true" class="pointer-events-none absolute inset-x-0 -top-10 -z-10">
      <div class="mx-auto h-64 w-[min(70rem,94vw)] rounded-full bg-brand-400/10 blur-3xl"></div>
    </div>

    <div class="mt-8 grid gap-3" data-faq>
      {
        items.map((it, idx) => {
          const buttonId = `faq-button-${idx}`;
          const panelId = `faq-panel-${idx}`;
          return (
            <div class="glass-panel overflow-hidden">
              <h3>
                <button
                  id={buttonId}
                  class="text-strong flex w-full items-center justify-between gap-4 px-6 py-5 text-left text-sm font-semibold focus-visible:outline-none"
                  type="button"
                  aria-expanded="false"
                  aria-controls={panelId}
                >
                  <span>{it.question}</span>
                  <span class="text-brand-700 dark:text-brand-300" aria-hidden="true">
                    +
                  </span>
                </button>
              </h3>
              <div
                id={panelId}
                role="region"
                aria-labelledby={buttonId}
                hidden
                class="text-muted px-6 pb-6 text-sm"
              >
                <p>{it.answer}</p>
              </div>
            </div>
          );
        })
      }
    </div>
  </div>

  {
    showWave ? (
      <div class="relative -mb-px mt-12">
        <WaveDivider tone="surface-muted" class="absolute bottom-0 left-0 right-0" />
      </div>
    ) : null
  }

  <script>
    (() => {
      const root = document.querySelector('[data-faq]');
      if (!root) return;

      const buttons = Array.from(root.querySelectorAll<HTMLButtonElement>('button[aria-controls]'));

      const setExpanded = (btn: HTMLButtonElement, expanded: boolean) => {
        const panelId = btn.getAttribute('aria-controls');
        if (!panelId) return;
        const panel = document.getElementById(panelId);
        if (!panel) return;
        btn.setAttribute('aria-expanded', String(expanded));
        const icon = btn.querySelector('[aria-hidden="true"]');
        if (icon) icon.textContent = expanded ? 'â€“' : '+';
        panel.hidden = !expanded;
      };

      buttons.forEach((btn) => {
        setExpanded(btn, false);
        btn.addEventListener('click', () => {
          const isOpen = btn.getAttribute('aria-expanded') === 'true';
          // close others
          buttons.forEach((b) => setExpanded(b, false));
          // toggle clicked
          setExpanded(btn, !isOpen);
        });
      });
    })();
  </script>
</section>
