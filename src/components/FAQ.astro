---
import { getCollection } from 'astro:content';
import WaveDivider from '@/components/WaveDivider.astro';
import SectionHeader from '@/components/ui/SectionHeader.astro';

type Props = {
  id?: string;
  heading?: string;
  description?: string;
  showWave?: boolean;
};

const {
  id = 'faq',
  heading = 'FAQ',
  description = 'Quick answers to common questions.',
  showWave = true,
} = Astro.props;

const faqs = await getCollection('faqs');
const items = faqs.map((f) => f.data);
---

<section id={id} class="section scroll-mt-20">
  <div class="container-page relative">
    <SectionHeader eyebrow="FAQ" heading={heading} description={description} />

    <div class="mx-auto mt-10 max-w-3xl space-y-3" data-faq>
      {
        items.map((it) => (
          <details
            class="group overflow-hidden rounded-2xl border border-brand-100/50 bg-white/80 shadow-sm backdrop-blur-sm transition-all duration-200 open:shadow-md dark:border-brand-800/30 dark:bg-slate-900/50"
            data-faq-item
          >
            <summary class="text-strong flex w-full cursor-pointer list-none items-center justify-between gap-4 px-6 py-5 text-left font-medium transition-colors hover:bg-brand-50/50 focus-visible:outline-none dark:hover:bg-brand-900/20">
              <span>{it.question}</span>
              <svg
                class="h-5 w-5 shrink-0 text-brand-500 transition-transform duration-200 group-open:rotate-180"
                aria-hidden="true"
                data-faq-icon
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="border-t border-brand-100/50 px-6 py-5 text-sm leading-relaxed text-muted dark:border-brand-800/30">
              <p>{it.answer}</p>
            </div>
          </details>
        ))
      }
    </div>
  </div>

  {
    showWave ? (
      <div class="relative -mb-px mt-16">
        <WaveDivider tone="surface-muted" class="absolute bottom-0 left-0 right-0" />
      </div>
    ) : null
  }

  <script>
    (() => {
      const root = document.querySelector('[data-faq]');
      if (!root) return;

      const items = Array.from(root.querySelectorAll<HTMLDetailsElement>('[data-faq-item]'));

      items.forEach((el) => {
        el.addEventListener('toggle', () => {
          // Keep it "dropdown" style: only one open at a time.
          if (el.open) items.forEach((other) => other !== el && (other.open = false));
        });
      });
    })();
  </script>
</section>

<style>
  /* Remove the default disclosure triangle marker for a cleaner dropdown look. */
  summary::-webkit-details-marker {
    display: none;
  }
</style>
