---
import { siteConfig } from '@/data/siteConfig';
import { makeHref } from '@/lib/nav';
import { makeMailtoHref, makeTelHref } from '@/lib/links';
import Eyebrow from './ui/Eyebrow.astro';

type Props = {
  /**
   * `centered` matches the old CTAStrip.
   * `split` matches the old ConversionStrip.
   */
  layout?: 'centered' | 'split' | undefined;

  // Shared-ish
  id?: string | undefined;
  eyebrow?: string | undefined;
  heading?: string | undefined;
  description?: string | undefined;

  // Centered layout (CTAStrip)
  background?: 'default' | 'accent' | undefined;
  // Kept for backward-compat in props shape, but this component no longer renders CTAs
  // because primary actions live in the top header.
  ctaText?: string | undefined;
  ctaHref?: string | undefined;

  // Split layout (ConversionStrip)
  /**
   * `muted` blends with the dotted section background.
   * `surface` uses the default page surface.
   */
  tone?: 'muted' | 'surface' | undefined;
  showChecklist?: boolean | undefined;
  showEmail?: boolean | undefined;
};

const href = makeHref(import.meta.env.BASE_URL);
const telHref = makeTelHref(siteConfig.contact.phoneE164);

const {
  layout = 'centered',

  id,
  eyebrow,
  heading,
  description,

  background = 'default',
  // ctaText/ctaHref intentionally not destructured (no CTAs rendered)

  tone = 'muted',
  showChecklist = true,
  showEmail = true,
} = Astro.props;

const mailtoHref = makeMailtoHref(siteConfig.contact.email);
---

{
  layout === 'centered' ? (
    <section
      class:list={[
        'section section-creative border-y',
        background === 'accent'
          ? 'border-white/10 bg-brand-950 text-white'
          : 'border-app section-muted',
      ]}
    >
      <div class="container-page">
        <div
          class:list={[
            'glass-card relative mx-auto max-w-3xl overflow-hidden rounded-2xl px-6 py-10 text-center sm:px-12 sm:py-12 lg:max-w-4xl lg:px-16 lg:py-16',
            background === 'accent' ? 'border-white/10 bg-brand-900/80' : 'bg-surface/60',
          ]}
        >
          {/* Decorative gradient blob */}
          <div class="pointer-events-none absolute -left-24 -top-24 h-64 w-64 rounded-full bg-brand-400/20 blur-3xl dark:bg-brand-600/10" />
          <div class="pointer-events-none absolute -bottom-24 -right-24 h-64 w-64 rounded-full bg-yellow-400/20 blur-3xl dark:bg-yellow-600/10" />

          <div class="relative z-10">
            <h2
              class:list={[
                'font-serif text-3xl font-bold tracking-tight sm:text-4xl lg:text-5xl',
                background === 'accent' ? 'text-white' : 'text-strong',
              ]}
            >
              {heading ?? 'Ready to get started?'}
            </h2>
            <p
              class:list={[
                'mx-auto mt-6 max-w-xl text-lg leading-relaxed lg:mt-8 lg:text-xl',
                background === 'accent' ? 'text-white/80' : 'text-muted',
              ]}
            >
              {description ?? "Request a quote and we'll confirm scope, then send clear pricing."}
            </p>

            <div class="mt-8 flex flex-col items-center justify-center gap-4 sm:flex-row">
              <a href={href('contact/')} class="btn-accent w-full sm:w-auto">
                Get a Free Quote
              </a>
              <a
                href={telHref}
                class:list={[
                  'text-sm font-medium transition-colors',
                  background === 'accent'
                    ? 'text-white/85 hover:text-white'
                    : 'text-muted hover:text-brand-600',
                ]}
              >
                Or call us directly: {siteConfig.contact.phoneDisplay}
              </a>
            </div>

            <p
              class:list={[
                'mt-5 text-xs',
                background === 'accent' ? 'text-white/70' : 'text-subtle',
              ]}
            >
              Clear scope. Consistent checklists. Fast follow-up.
            </p>
          </div>
        </div>
      </div>
    </section>
  ) : (
    <section
      id={id}
      class:list={[
        'section section-creative scroll-mt-20',
        tone === 'muted' ? 'section-muted' : '',
      ]}
      aria-label="Get started"
    >
      <div class="container-page">
        <div class="card relative overflow-hidden p-6 sm:p-8 lg:p-14">
          <div class="relative grid gap-8 md:grid-cols-2 md:items-center lg:gap-12">
            <div>
              <Eyebrow>{eyebrow ?? 'Next step'}</Eyebrow>
              <h2 class="heading-2 mt-2 lg:text-4xl">{heading ?? 'Ready to scope your space?'}</h2>
              <p class="lede lg:text-lg">
                {description ??
                  'Preview our checklist and review scope details. When you’re ready, use the phone number above or request a quote from the top menu.'}
              </p>

              <ul class="check-list check-list--compact text-subtle text-sm sm:grid-cols-2">
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>Written scope + checklist</span>
                </li>
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>Fast replies during business hours</span>
                </li>
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>After-hours / weekend options</span>
                </li>
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>One point of contact</span>
                </li>
              </ul>
            </div>

            <div class="flex flex-col gap-3 md:justify-self-end">
              {showChecklist ? (
                <a
                  class="btn-secondary w-full sm:w-auto md:justify-self-end"
                  href={href('checklist/')}
                >
                  Preview checklist
                </a>
              ) : null}

              {showEmail ? (
                <div class="text-subtle mt-1 text-xs">
                  <a class="link link-muted" href={mailtoHref}>
                    Email
                  </a>
                </div>
              ) : null}
            </div>
          </div>
        </div>
      </div>
    </section>
  )
}
