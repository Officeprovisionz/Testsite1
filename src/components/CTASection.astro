---
import { siteConfig } from '@/data/siteConfig';
import { makeHref } from '@/lib/nav';
import { makeMailtoHref } from '@/lib/links';

type Props = {
  /**
   * `centered` matches the old CTAStrip.
   * `split` matches the old ConversionStrip.
   */
  layout?: 'centered' | 'split' | undefined;

  // Shared-ish
  id?: string | undefined;
  eyebrow?: string | undefined;
  heading?: string | undefined;
  description?: string | undefined;

  // Centered layout (CTAStrip)
  background?: 'default' | 'accent' | undefined;
  // Kept for backward-compat in props shape, but this component no longer renders CTAs
  // because primary actions live in the top header.
  ctaText?: string | undefined;
  ctaHref?: string | undefined;

  // Split layout (ConversionStrip)
  /**
   * `muted` blends with the dotted section background.
   * `surface` uses the default page surface.
   */
  tone?: 'muted' | 'surface' | undefined;
  showChecklist?: boolean | undefined;
  showEmail?: boolean | undefined;
};

const href = makeHref(import.meta.env.BASE_URL);

const {
  layout = 'centered',

  id,
  eyebrow,
  heading,
  description,

  background = 'default',
  // ctaText/ctaHref intentionally not destructured (no CTAs rendered)

  tone = 'muted',
  showChecklist = true,
  showEmail = true,
} = Astro.props;

const mailtoHref = makeMailtoHref(siteConfig.contact.email);
---

{
  layout === 'centered' ? (
    <section
      class:list={[
        'section section-creative border-y py-16 lg:py-20',
        background === 'accent'
          ? 'border-white/10 bg-slate-950 text-white'
          : 'border-app section-muted',
      ]}
    >
      <div class="container-page">
        <div
          class:list={[
            'relative mx-auto max-w-3xl overflow-hidden rounded-[var(--radius-card)] border px-6 py-10 text-center shadow-soft sm:px-10',
            background === 'accent'
              ? 'border-white/10 bg-white/5'
              : 'border-app bg-white dark:bg-slate-950/25',
          ]}
        >
          <div class="relative">
            <h2
              class:list={[
                'text-2xl font-bold tracking-tight sm:text-3xl',
                background === 'accent' ? 'text-white' : 'text-strong',
              ]}
            >
              {heading ?? 'Ready to get started?'}
            </h2>
            <p
              class:list={[
                'mx-auto mt-4 max-w-xl text-base',
                background === 'accent' ? 'text-white/80' : 'text-muted',
              ]}
            >
              {description ?? "Request a quote and we'll confirm scope, then send clear pricing."}
            </p>

            <p
              class:list={[
                'mt-7 text-sm',
                background === 'accent' ? 'text-white/75' : 'text-subtle',
              ]}
            >
              Phone and quote request are available in the top menu.
            </p>

            <p
              class:list={[
                'mt-5 text-xs',
                background === 'accent' ? 'text-white/70' : 'text-subtle',
              ]}
            >
              Clear scope. Consistent checklists. Fast follow-up.
            </p>
          </div>
        </div>
      </div>
    </section>
  ) : (
    <section
      id={id}
      class:list={[
        'section section-creative scroll-mt-20',
        tone === 'muted' ? 'section-muted' : '',
      ]}
      aria-label="Get started"
    >
      <div class="container-page">
        <div class="card relative overflow-hidden p-7 sm:p-10">
          <div class="relative grid gap-8 md:grid-cols-2 md:items-center">
            <div>
              <p class="eyebrow">{eyebrow ?? 'Next step'}</p>
              <h2 class="heading-2 mt-2">{heading ?? 'Ready to scope your space?'}</h2>
              <p class="lede">
                {description ??
                  'Preview our checklist and review scope details. When you’re ready, use the phone number above or request a quote from the top menu.'}
              </p>

              <ul class="check-list check-list--compact text-subtle text-sm sm:grid-cols-2">
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>Written scope + checklist</span>
                </li>
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>Fast replies during business hours</span>
                </li>
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>After-hours / weekend options</span>
                </li>
                <li>
                  <span class="check-icon check-icon--sm" aria-hidden="true">
                    ✓
                  </span>
                  <span>One point of contact</span>
                </li>
              </ul>
            </div>

            <div class="flex flex-col gap-3 md:justify-self-end">
              {showChecklist ? (
                <a class="btn-secondary md:justify-self-end" href={href('checklist/')}>
                  Preview checklist
                </a>
              ) : null}

              {showEmail ? (
                <div class="text-subtle mt-1 text-xs">
                  <a class="link link-muted" href={mailtoHref}>
                    Email
                  </a>
                </div>
              ) : null}
            </div>
          </div>
        </div>
      </div>
    </section>
  )
}
