---
import { getCollection } from 'astro:content';
import WaveDivider from '@/components/WaveDivider.astro';
import SectionHeader from '@/components/ui/SectionHeader.astro';

type Props = {
  id?: string;
  heading?: string;
  description?: string;
};

const {
  id,
  heading = 'Who we serve',
  description = 'Commercial cleaning built for real workplaces—scoped clearly and delivered consistently.',
} = Astro.props;

const base = import.meta.env.BASE_URL;
const href = (path: string) => `${base}${path.replace(/^\/+/, '')}`;

const allIndustries = await getCollection('industries');
const featured = allIndustries[0]?.data;
const rest = allIndustries.slice(1).map((i) => i.data);
---

<section id={id} class="section section-creative scroll-mt-20 pb-0">
  <div class="container-page relative">
    <SectionHeader eyebrow="Industries" heading={heading} description={description}>
      <a slot="actions" class="btn-secondary hidden sm:inline-flex" href={href('services/')}
        >Explore services</a
      >
    </SectionHeader>

    <div aria-hidden="true" class="pointer-events-none absolute inset-x-0 -top-12 -z-10">
      <div class="mx-auto h-72 w-[min(72rem,95vw)] rounded-full bg-brand-500/10 blur-3xl"></div>
    </div>

    <div class="mt-10 grid gap-6 lg:grid-cols-12 lg:items-stretch">
      {
        featured && (
          <article class="glass-card relative overflow-hidden lg:col-span-7">
            <div
              aria-hidden="true"
              class="from-brand-200/18 to-brand-300/14 pointer-events-none absolute inset-0 bg-gradient-to-br via-transparent"
            />
            <div class="relative grid gap-6 p-7 sm:p-9">
              <div>
                <p class="eyebrow">Common fit</p>
                <h3 class="text-strong mt-2 text-2xl font-semibold tracking-tight">
                  {featured.title}
                </h3>
                <p class="mt-3 max-w-prose leading-relaxed text-muted">{featured.description}</p>
              </div>
              <ul class="check-list check-list--compact text-sm text-muted sm:grid-cols-2">
                {featured.bullets.map((b) => (
                  <li>
                    <span class="check-icon check-icon--sm" aria-hidden="true">
                      ✓
                    </span>
                    <span>{b}</span>
                  </li>
                ))}
              </ul>
            </div>
          </article>
        )
      }

      <div class="grid gap-6 lg:col-span-5">
        {
          rest.map((it, idx) => (
            <article
              class:list={[
                'glass-panel relative overflow-hidden p-6',
                idx === 0 ? 'lg:translate-y-6' : '',
              ]}
            >
              <div
                aria-hidden="true"
                class="from-brand-200/14 pointer-events-none absolute inset-0 bg-gradient-to-br via-transparent to-brand-300/10"
              />
              <div class="relative">
                <h3 class="text-strong text-lg font-semibold tracking-tight">{it.title}</h3>
                <p class="mt-2 text-sm leading-relaxed text-muted">{it.description}</p>
                <ul class="check-list check-list--compact text-sm text-muted sm:grid-cols-3">
                  {it.bullets.map((b) => (
                    <li>
                      <span class="check-icon check-icon--sm" aria-hidden="true">
                        ✓
                      </span>
                      <span>{b}</span>
                    </li>
                  ))}
                </ul>
              </div>
            </article>
          ))
        }
      </div>
    </div>

    <div class="mt-8 flex flex-col gap-3 sm:hidden">
      <a class="btn-secondary" href={href('services/')}>Explore services</a>
    </div>
  </div>

  <div class="relative -mb-px mt-12">
    <WaveDivider tone="surface-muted" class="absolute bottom-0 left-0 right-0" />
  </div>
</section>
